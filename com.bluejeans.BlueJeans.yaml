app-id: com.bluejeans.BlueJeans
base: io.atom.electron.BaseApp
base-version: '19.08'
runtime: org.freedesktop.Platform
runtime-version: '19.08'
sdk: org.freedesktop.Sdk
separate-locales: false
command: bluejeans
tags:
  - proprietary
finish-args:
  - --socket=wayland
  - --socket=x11
  - --share=ipc
  - --device=all
  - --socket=pulseaudio
  - --share=network
  - --persist=.config
  - --persist=.macromedia
  - --filesystem=xdg-videos
cleanup:
  - /include
  - /lib/*.a
  - /lib/*.la
  - /lib/pkgconfig
  - /share/man
modules:
  - name: cpio
    buildsystem: autotools
    sources:
      - type: archive
        url: https://ftp.gnu.org/gnu/cpio/cpio-2.12.tar.gz
        sha256: 08a35e92deb3c85d269a0059a27d4140a9667a6369459299d08c17f713a92e73

  - name: rpm2cpio
    buildsystem: simple
    sources:
      - type: archive
        url: https://github.com/ruda/rpm2cpio/archive/2017.tar.gz
        sha256: d266a4f49e65b5d05956502549ceb1d5671f927375ff71299069e6d92363297a
      - type: patch
        path: rpm2cpio.patch
    build-commands:
      - install -D rpm2cpio.py /app/bin/rpm2cpio

  - name: bluejeans
    buildsystem: simple
    sources:
      - type: file
        path: com.bluejeans.BlueJeans.appdata.xml
      - type: file
        path: com.bluejeans.BlueJeans.desktop
      - type: file
        path: com.bluejeans.BlueJeans.png
      - type: extra-data
        filename: bluejeans.rpm
        url: https://swdl.bluejeans.com/desktop-app/linux/2.21.2/BlueJeans_2.21.2.1.rpm
        sha256: 5a8a997b3954cec032550c87aff76a0708766065798296f349e90c5bda647461
        size: 82664412
        x-checker-data:
          type: html
          url: https://www.bluejeans.com/downloads
          version-pattern: <a href="https://swdl.bluejeans.com/desktop-app/linux/[\d\.-]*/BlueJeans_([\d\.-]*).rpm"
            class="Button" aria-label="Download BlueJeans for Linux">
          url-pattern: <a href="(https://swdl.bluejeans.com/desktop-app/linux/[\d\.-]*/BlueJeans_[\d\.-]*.rpm)"
            class="Button" aria-label="Download BlueJeans for Linux">
          only-arches: [x86_64]
      - type: script
        dest-filename: apply_extra
        commands:
          - rpm2cpio bluejeans.rpm | cpio -idm
          - rm bluejeans.rpm
          - mv opt/BlueJeans/* .
          - rm -r opt usr
          - chmod 755 bluejeans-v2
          - chmod 755 /app/extra/resources/BluejeansHelper
      - type: script
        dest-filename: bluejeans
        commands:
          - '[ -d /var/home ] && unlink /home && mv /var/home /home'
          - export LD_LIBRARY_PATH=/app/lib
          - exec /app/extra/bluejeans-v2 $@ 2>&1 | grep -v -E ".*Gtk-Message:.*Failed
            to load module.*|:INFO:"
    build-commands:
      - install -D apply_extra /app/bin/apply_extra
      - install -D bluejeans /app/bin/bluejeans
      - install -Dm 644 com.bluejeans.BlueJeans.appdata.xml -t /app/share/appdata
      - install -Dm 644 com.bluejeans.BlueJeans.desktop -t /app/share/applications
      - install -Dm 644 com.bluejeans.BlueJeans.png -t /app/share/icons/hicolor/128x128/apps
