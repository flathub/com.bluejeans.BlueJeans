app-id: com.bluejeans.BlueJeans
base: org.electronjs.Electron2.BaseApp
base-version: '19.08'
runtime: org.freedesktop.Platform
runtime-version: '19.08'
sdk: org.freedesktop.Sdk
separate-locales: false
command: bluejeans
tags:
  - proprietary
finish-args:
  - --socket=wayland
  - --socket=x11
  - --share=ipc
  - --device=all
  - --socket=pulseaudio
  - --share=network
  - --persist=.config
  - --persist=.pki
  - --filesystem=xdg-videos
  - --talk-name=org.freedesktop.Notifications
cleanup:
  - /include
  - /lib/*.a
  - /lib/*.la
  - /lib/pkgconfig
  - /share/man
modules:
  - name: cpio
    buildsystem: autotools
    sources:
      - type: archive
        url: https://ftp.gnu.org/gnu/cpio/cpio-2.12.tar.gz
        sha256: 08a35e92deb3c85d269a0059a27d4140a9667a6369459299d08c17f713a92e73

  - name: rpm2cpio
    buildsystem: simple
    sources:
      - type: archive
        url: https://github.com/ruda/rpm2cpio/archive/2017.tar.gz
        sha256: d266a4f49e65b5d05956502549ceb1d5671f927375ff71299069e6d92363297a
      - type: patch
        path: rpm2cpio.patch
    build-commands:
      - install -D rpm2cpio.py /app/bin/rpm2cpio

  - name: bluejeans
    buildsystem: simple
    sources:
      - type: file
        path: com.bluejeans.BlueJeans.appdata.xml
      - type: file
        path: com.bluejeans.BlueJeans.desktop
      - type: file
        path: com.bluejeans.BlueJeans.png
      - type: extra-data
        filename: BlueJeans.rpm
        url: https://swdl.bluejeans.com/desktop-app/linux/2.17.0/BlueJeans_2.17.0.11.rpm
        sha256: c8282ee53e394c70c88d5a1a535d02ffaeb3115031a8a4ea5dc6f355ae5db2c0
        size: 78124344
      - type: script
        dest-filename: apply_extra
        commands:
          - rpm2cpio BlueJeans.rpm | cpio -idmv
          - rm BlueJeans.rpm
          - mv opt/BlueJeans/* .
          - rm -r opt usr
          - chmod 755 bluejeans-v2
          - chmod 755 resources/BluejeansHelper
      - type: script
        dest-filename: bluejeans
        commands:
          - "[ -d /var/home ] && unlink /home && mv /var/home /home"
          - "[ ! -d ~/.config/bluejeans-v2/logs ] && mkdir -p ~/.config/bluejeans-v2/logs"
          - "/app/extra/resources/BluejeansHelper &"
          - "HELPER_PID=$!"
          - "/app/extra/bluejeans-v2 $@"
          - "kill -9 $HELPER_PID"
    build-commands:
      - install -D apply_extra /app/bin/apply_extra
      - install -D bluejeans /app/bin/bluejeans
      - install -Dm 644 com.bluejeans.BlueJeans.appdata.xml -t /app/share/appdata
      - install -Dm 644 com.bluejeans.BlueJeans.desktop -t /app/share/applications
      - install -Dm 644 com.bluejeans.BlueJeans.png -t /app/share/icons/hicolor/256x256/apps
